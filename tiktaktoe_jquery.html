<!doctype html>
<html>

<head>
    <title>TikTakToe</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Tim Henrik Seib" />
    <link href="tiktakto.css" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&family=Righteous&display=swap"
        rel="stylesheet">
    <style>
        table {
            width: 600px;
            height: 600px;
        }

        table,
        tr,
        td {
            border: 5px solid #000000;
            border-collapse: collapse;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body>
    <h1 class="headline">tik,tAk & toe</h1>
    <p> <input type="number" id="fieldX" value="3"> <button onclick="resetArray() + sizeOfField()">confirm!</button>
    </p>
    <p> <input style="color: #78CDD7;" id="PlayerOne" value="Name 01"> | <input style="color: #F7CACD;" id="PlayerTwo"
            value="Name 02"> <button onclick="confirm()"> confirm!</button>
    <p><span style="font-size: 20px;" id="score"> </span> | <span style="font-size: 20px;" id="scoreTwo"></span></p>
    <p> It´s your turn ... <span id="playerTurn"></span> </p>
    <table align="center">
    </table>

    <script>
        let pointsname1 = 0;
        let pointsname2 = 0;
        // UI erstellen
        let size = ""
        let id = ""
        let fieldArray = []


        //Feld Größe entscheiden
        function sizeOfField() {
            $("tr").remove()
            size = $("#fieldX").val()
            console.log(size)

            for (let i = 0; i < size; i++) {

                //create Array für jede Zeile
                fieldArray.push([]);

                id = "Zeile" + i
                //Reihe einfügen
                $("table").append("<tr id=" + id + "> </tr>")

                for (let t = 0; t < size; t++) {
                    //create Array für jedes Feld
                    fieldArray[i].push("");
                    //td einfügen
                    $("#" + id).append("<td id=Zelle" + i + t + "></td>");
                    $("#" + "Zelle" + i + t).on("click", function () { clickPlayer("Zelle" + i + t) });
                }
            } console.log(fieldArray)
        }

        //Deklariation von Variablen
        let playerOne = ""
        let playerTwo = ""
        let aktuellerSpieler

        //Zufällig Spieler auswählen, welcher beginnnt 

        function beginner() {
            if (getRandomInt(2) >= 1) {
                aktuellerSpieler = playerOne
            } else {
                aktuellerSpieler = playerTwo
            }
            return aktuellerSpieler
        }

        //It´s your turn Feld mit Inhalt füllen
        function confirm() {
            playerOne = document.getElementById("PlayerOne").value
            playerTwo = document.getElementById("PlayerTwo").value
            document.getElementById("playerTurn").innerText = beginner()
        }

        //abwechselnd Spieler (Player 1 oder Player 2)

        function change() {
            if (aktuellerSpieler === playerOne) {
                aktuellerSpieler = playerTwo
            } else if (aktuellerSpieler === playerTwo) {
                aktuellerSpieler = playerOne
            }
            document.getElementById("playerTurn").innerText = aktuellerSpieler
        }

        $("span#playerTurn").text(aktuellerSpieler) //ersetzt den Text-Inhalt des span

        //Zufällig Spieler auswählen, welcher beginnnt 
        function beginner() {
            if (getRandomInt(2) >= 1) {
                aktuellerSpieler = playerOne
            } else {
                aktuellerSpieler = playerTwo
            }
            return aktuellerSpieler
        }

        //Auf User Klick reagieren
        //anklickbar machen
        //Nur ein Zeichen Pro Feld

        function clickPlayer(id) {
            if ($("#" + id).css("background-color") === "rgb(204, 197, 185)") {
                $("#" + id).css("background-color", colourChange());
                // Angeklickte Zelle mit player füllen
                id = id.replace("Zelle", "")
                let zeile = id[0];
                let reihe = id[1];
                fieldArray[zeile][reihe] = aktuellerSpieler;
                console.log(fieldArray)
                WinCheck()
                change()
            }
        }

        //Bei neuem Spieler und nach klick bekommt man eine neue farbe

        function colourChange() {
            if (aktuellerSpieler === playerOne) {
                return "#78CDD7"
            } else if (aktuellerSpieler === playerTwo) {
                return "#F7CACD"
            }
        }

        //Gewinnbedingung erstellen
        pointsToWin = 3

        function WinCheck() {
            // schleife überprüft das Spielfeld
            let fieldX = $("#fieldX").val()
            let horizontal = "";
            let vertikal = "";
            // Gewinnbedingung 
            let victoryOne = playerOne.repeat(pointsToWin)
            let victoryTwo = playerTwo.repeat(pointsToWin)
            // vertikal und horizontal Linien testen
            for (let i = 0; i < fieldX; i++) {
                horizontal = "";
                vertikal = "";
                //Jedes Feld in der Linie testen
                for (let t = 0; t < fieldX; t++) {
                    // Inhalt der Felder in string einsetzen

                    horizontal += fieldArray[i][t]
                    vertikal += fieldArray[t][i]
                }
                // die erstellten Strings auf die Gewinnbedingung kontrollieren
                if (horizontal.includes(victoryOne)) {
                    alert(playerOne + " won")
                    pointsname1++
                    score()
                    resetArray();
                    sizeOfField();
                }
                else if (horizontal.includes(victoryTwo)) {
                    alert(playerTwo + " won")
                    pointsname2++
                    score()
                    resetArray();
                    sizeOfField();
                }
                if (vertikal.includes(victoryOne)) {
                    alert(playerOne + " won");
                    pointsname1++
                    score()
                    resetArray();
                    sizeOfField();
                }
                else if (vertikal.includes(victoryTwo)) {
                    alert(playerTwo + " won")
                    pointsname2++
                    score()
                    resetArray();
                    sizeOfField();
                }
            }
            
            // diagonale Felder checken
            let diagonal = ""; //links oben nach rechts unten
            let diagonalZwei = ""; //links unten nach recht oben

            for (let i = 0; i < fieldX; i++) {
                for (let h = 0; h < fieldX; h++) {
                    // jedes Feld von links oben nach rechts unten testen
                    diagonal = "";
                diagonalZwei = "";
                //nur im array checken
                if (i + (pointsToWin - 1) < fieldX) {
                    if (h + (pointsToWin - 1) < fieldX) {
                        for (let m = 0; m < pointsToWin; m++) {
                            diagonal += fieldArray[i + m][h + m];
                        }

                            // gewinner checken
                        if (diagonal.includes(victoryOne)) {
                                alert(playerOne + " won");
                                pointsname1++
                                
                                score()
                                resetArray();
                                sizeOfField();
                            } else if (diagonal.includes(victoryTwo)) {
                                alert(playerTwo + " won")
                                pointsname2++
                                score()
                                resetArray();
                                sizeOfField();
                            }
                        }
                    }
                    if (h - (pointsToWin - 1) >= 0) {
                        if (i + (pointsToWin - 1) < fieldX) {
                            for (let m = 0; m < pointsToWin; m++) {
                                diagonalZwei += fieldArray[i + m][h - m];
                            }
                            if (diagonalZwei.includes(victoryOne)) {
                                alert(playerOne + " won");
                                pointsname1++
                                score()
                                resetArray();
                                sizeOfField();
                            } else if (diagonalZwei.includes(victoryTwo)) {
                                alert(playerTwo + " won")
                                pointsname2++
                                score()
                                resetArray();
                                sizeOfField();
                            }
                        }
                    }
                }
            }
        }

        // Array komplett löschen
        function resetArray() {
            fieldArray.splice(0, fieldArray.length)
        }

        //Spielstand anzeigen
        function score() {
            // Zeichen "I" jedes mal bei gewinner hinzufügen
            let char = "I"
            //reset span
            $('#score').text("")
            $('#scoreTwo').text("")
            // update span

            let temp1 = char.repeat(pointsname1) 
            let temp2 = char.repeat(pointsname2)
            console.log((pointsname1 % 5) + "|"+(pointsname1 % 5))
        
            // ab 5 Punkte Linie durchstrichen
            if ((pointsname1 ) === 5 ){
                document.getElementById('score').style.textDecoration = 'line-through';
            }
            if ((pointsname2 ) === 5 ){
                document.getElementById('scoreTwo').style.textDecoration = 'line-through';
                }
            $('#score').text(temp1)
            $('#scoreTwo').text(temp2)

        }

        $("span#score").text(score()) //ersetzt den Text-Inhalt des span

        // Zufallszahl generieren
        function getRandomInt(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }



    </script>

</body>

</html>